# 二分圖

## 題目

>Write a predicate that finds out whether a given graph is bipartite.

### 二分圖

>二分圖又稱雙分圖、二部圖、偶圖，指頂點可以分成兩個互斥的獨立集$$U$$和$$V$$的圖，也就是在任兩個同在$$U$$或$$V$$的頂點不相鄰。
>
>二分圖又稱作二部圖，是圖論中的一種特殊模型。 設 $$G=(V,E)$$是一個無向圖，如果頂點V可分割為兩個互斥的子集 $${\displaystyle (U,V)}$$，並且圖中的每條邊$${\displaystyle (i,j)}$$的兩個端點$$i$$和$$j$$分別屬於這兩個不同的頂點集 ，則稱圖$$G$$為一個二分圖。
>
>無向圖$$G$$為二分圖的充分必要條件是，$$G$$至少有兩個頂點，且其所有迴路的長度均為偶數。
>
>可以將$$U$$和$$V$$當做一個著色：$$U$$中所有頂點為藍色，$$V$$中所有頂點著綠色，每條邊的兩個端點的顏色不同，符合圖著色問題的要求。相反的，非二分圖無法被二著色，例如 $$K_{3}$$(3 個頂點的完全圖)，將其中一個頂點著藍色並且另外一個著綠色後，第三個頂點與上述具有兩個顏色的頂點相連，無法再對它著藍色或綠色。

#### 二分性測試

>給定一個圖，使用深度優先搜尋法，可以在線性時間內判斷它是否為二分圖，並輸出一個二著色 (若答案為是)，或是一個奇環 (若答案為否)。方法是先用深度優修搜尋法找出圖的一個深度優先搜尋森林 (各連通部分取一個深度優先搜尋樹)，這是圖的一個生成森林。接著運用樹的搜尋將森林二著色，也就是依序各頂點著和它的父節點相異的顏色。現在檢查原圖中深度優先搜尋森林以外的其他邊，如果所有邊的兩端點都不同顏色，則這也是原圖的一個二著色，並且輸出它；如果有一個邊 e 的兩端點相同顏色，則此兩端點在同一個連通部分，也就是在森林的同一棵樹上，找出在森林中，連接兩端點的路徑 P，因為 P 上的頂點的顏色是交錯出現的，因此 P 有偶數個頂點，加上 e 就形成一個奇環，並且輸出它。
>
>事實上，在上述的演算法中，深度優先搜尋森林只是作為一個生成森林，讓我們來著色。因此，用不同的方式獲得的別的生成森林仍然可以使演算法可以運作，例如，可以用廣度優先搜尋取出廣度優先搜尋森林。
>
>如果原圖是線段，或其他二維空間的物件，的交集圖，並且有 n 個頂點，則可以在$$O(n\log n)$$時間內輸出一個二著色或奇環，縱使它的邊樹可能會高達$$O(n^{2})$$。

## 解題思路

使用二分性測試檢測圖是否為二分圖。
首先，用深度優先搜索法求出圖的深度優先搜尋森林。依次從圖中每個點出發，對圖做深度優先搜索。對結果去重復就得到深度優先搜索森林。
然後，對每棵搜索樹進行二元標色。從頂點開始交替標色。
最後，判斷所有邊的兩端點顏色是不不同。是則該圖為二分圖，否則不是。

舉個例子，給定如下圖

```plantuml
graph g {
    a -- c
    a -- d
    b -- c
    b -- d
}
```

首先，使用深度優先搜索求出搜尋樹`[a, c, b, d]`。

```plantuml
graph g {
    a -- c
    a -- d [style=invis]
    b -- c
    b -- d
}
```

然後，對搜尋樹進行二元標色。

```plantuml
graph g {
    a [style=filled, fillcolor=green] 
    c [style=filled, fillcolor=red]
    b [style=filled, fillcolor=green]
    d [style=filled, fillcolor=red]
    a -- c
    a -- d [style=invis]
    b -- c
    b -- d
}
```

最後，檢測所有邊。是否存在邊其兩諯點顏色相同。否則該圖為二分圖。

```plantuml
graph g {
    a [style=filled, fillcolor=green] 
    c [style=filled, fillcolor=red]
    b [style=filled, fillcolor=green]
    d [style=filled, fillcolor=red]
    a -- c
    a -- d
    b -- c
    b -- d
}
```

### 代碼實現

[include](../../../python99/graph/p610.py)

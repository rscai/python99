# P202: Determine the prime factors of a given positive integer

質因數分解。

>在數學中，整數分解又稱質因數分解（prime factorization），是將一個正整數寫成幾個因數皫乘積。例如，給出45這個數，它可以分解成$$3^2*5$$。根據**算術基本定理**，這樣的分解結果應該是獨一無二的。這個問題在代數學、密碼學、計算複雜性理論和量子計算機等領域中有重要意義。[^wiki-integer-factorization]

照例先寫測試用例：

[include](../../../tests/arithmetic/p202_test.py)

## 試除法

>試除法是整數分解算法中最簡單和最容易理解的算法。首次出現於義大利數學家斐波那契出版於1202年的著作。
>
>給定一個合數n（這裡，n是待分解的正整數），試除法看成是用小於等於 $${\displaystyle {\sqrt {n}}}$$的每個質數去試除待分解的整數。如果找到一個數能夠整除除盡，這個數就是待分解整數的因子。試除法一定能夠找到n的因子。因為它檢查n的所有可能的因子，所以如果這個算法「失敗」，也就證明了n是個質數。試除法可以從幾條途徑來完善。例如，n的末位數不是0或者5，那麼算法中就可以跳過末位數是5的因子。如果末位數是2，檢查偶數因子就可以了。
>
>某種意義上說，試除法是個效率非常低的算法，如果從2開始，一直算到 $${\displaystyle {\sqrt {n}}}$$需要 $${\displaystyle \pi ({\sqrt {n}})}$$次試除，這裡$$\pi(x) $$是小於x的質數的個數。這是不包括質數測試的。如果稍做變通——還是不包括質數測試——用小於 $${\displaystyle {\sqrt {n}}}$$的奇數去簡單的試除，則需要 $${\displaystyle {\sqrt {n} \over 2}}$$次。這意味著，如果n有大小接近的質因子（例如公鑰密碼學中用到的），試除法是不太可能實行的。但是，當n有至少一個小因子，試除法可以很快找到這個小因子。值得注意的是，對於隨機的n，2是其因子的機率是50％，3是33％，等等，88％的正整數有小於100的因子，91％的正整數有小於1000的因子。[^wiki-trial-division]

我們就用「效率非常低」的「試除法」。用一個質數去除，若能整除（餘數為0），則該質數為其中一個質因數，繼續用該質數去除商數；若不能整除（餘數不為0），則該質數不為其中一個質因數，嘗試用下一個質數去除；直至商數是質數（為質數的商數為最後一個質因數。

舉個例子，給定數字`315`：

1. 先用最小的質數`2`去除，發現不能整除 $$315 \mod 2 = 1$$
2. 再用`2`後一個質數`3`去除，發現`315`能被`3`整除且商為`105`，所以`3`是其質因數之一
3. 再用`3`除商數`105`，發現能整除且商為`35`，所有其質因數序列中有兩個`3`
4. 再用`3`除商數`35`，發現不能整除，則用下一個質數`5`去除，發現能除且商為`7`，所以`5`是其質因數之一
5. 商數`7`是質數，其是最後一個質因素。最終得到質因素列表`[3, 3, 5, 7]`

$$
\begin{align*}
315 &= 2^0 \times 315 \tag{1} \\
    &= 2^0 \times 3^1 \times 105 \tag{2} \\
    &= 2^0 \times 3^2 \times 35 \tag{3} \\
    &= 2^0 \times 3^2 \times 5^1 \times 7 \tag{4} \\
    & = 2^0 \times 3^2 \times 5^1 \times 7^1 \tag{5}
\end{align*}
$$

代碼實現：

[include:-16](../../../python99/arithmetic/p202.py)

為實現以上算法，我們需要兩個輔助函數：「判斷是否為質數」和「下一個質數」。「判斷是否為質數」可以重用P201中實現的`is_prime`。而「下一個質數」則需要現埸實現。根據伯特蘭-切比雪夫定理，給定整數$$n$$，遍歷$$n$$至$$2n$$之間的整數，一定能找到一個質數。

>伯特蘭-切比雪夫定理說明：若整數$n>3$，則至少存在一個質數$$p$$，符合 $$n<p<2n-2$$。另一個稍弱說法是：對於所有大於1的整數$$n$$，存在一個質數$$p$$，符合$$n<p<2n$$。1845年約瑟．伯特蘭提出這個猜想。伯特蘭檢查了2至$$3\times10^6$$之間的所有數。1850年切比雪夫證明了這個猜想。拉馬努金給出較簡單的證明，而保羅．艾狄胥則借二項式人竹女戈火數給出了另一個簡單的證明。[^wiki-Bertrand]

「下一個質數」代碼實現：

[include:18-](../../../python99/arithmetic/p202.py)

## 參考文献

[^wiki-integer-factorization]:https://zh.wikipedia.org/wiki/整數分解
[^wiki-trial-division]: https://zh.wikipedia.org/wiki/試除法
[^wiki-Bertrand]:https://zh.wikipedia.org/wiki/伯特蘭-切比雪夫定理